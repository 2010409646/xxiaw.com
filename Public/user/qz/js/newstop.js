var App=App||{};App.ui=App.ui||{},App.userPrefix="http://user.btime.com",App.userDataApi={userLogin:App.userPrefix+"/getUserInfo",userLoginOut:App.userPrefix+"/logout"},App.share=function(e,t,n,r){var i={douban:"http://shuo.douban.com/%21service/share?image=!!pic!!&href=!!url!!&name=!!title!!&text=!!text!!",qweibo:"http://share.v.t.qq.com/index.php?c=share&a=index&title=!!title!!%20-%20!!text!!&url=!!url!!&pic=!!pic!!",qzone:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=!!url!!&title=!!title!!&pics=!!pic!!&summary=!!text!!",renren:"http://widget.renren.com/dialog/share?resourceUrl=!!url!!&srcUrl=!!url!!&title=!!title!!&pic=!!pic!!&description=!!text!!",weibo:"http://service.weibo.com/share/share.php?url=!!url!!&appkey=&title=!!text!!%20!!title!!&pic=!!pic!!&language=zh_cn"};$(".vote-share").on("click","a",function(n){var s=$(n.target),o=s.attr("class"),u=i[o],a=$(".content-text"),f={};f.title=e,f.url=t,f.text=r;var l=u.replace(/\!\!([a-z]+)\!\!/g,function(e,t){return encodeURIComponent(f[t])});window.open(l)})},App.commentLoginWithMessage=function(e){var t=$(".fixed");if(t.length)t.show();else{var n='<div class="fixed"><div class="login-alert"><div class="comment-close"><img src="http://p8.qhimg.com/t01835759b325e8fbe3.png" alt=""></div><div class="login-a"><span>'+e+'，<a href="http://user.btime.com/viewShow?gate=login">前往登录</a></span></div></div></div>';$("body").append($(n)).show(),$(".comment-close").on("click",function(e){$(this).closest(".fixed").remove()})}},App.commentLogin=function(){var e=$(".fixed");if(e.length)e.show();else{var t='<div class="fixed"><div class="login-alert"><div class="comment-close"><img src="http://p8.qhimg.com/t01835759b325e8fbe3.png" alt=""></div><div class="login-a"><span>登录之后方可评论，<a href="http://user.btime.com/viewShow?gate=login">前往登录</a></span></div></div></div>';$("body").append($(t)).show(),$(".comment-close").on("click",function(e){$(this).closest(".fixed").remove()})}},App.calendar=function(){var e=$(".calendar-day"),t=$(".calendar-week"),n=new Date,r=n.getMonth()+1,i=n.getDate(),s=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];e.html(r+"月"+i+"日"),t.html(s[n.getDay()])},App.userLogin=function(){var e=$(".userinfo"),t=qboot.cookie,n='<img src="http://p6.qhimg.com/d/inn/7f69123b/_user_photo.png"><a href="http://user.btime.com/viewShow?gate=login">登录</a> |<a href="http://user.btime.com/viewShow?gate=register">注册</a>';t.get("lf")==1?$.ajax({type:"get",dataType:"jsonp",url:App.userDataApi.userLogin}).done(function(t){if(t.errno==0){var r;t.data.head_img===null?r="http://p6.qhimg.com/d/inn/7f69123b/_user_photo.png":r=t.data.head_img.img_30;var i=App.userPrefix+"/viewShow?gate=info",s='<a href="'+i+'"><img src="'+r+'"></a>'+'<span class="user-Name">'+'<a href="'+i+'">'+t.data.nick_name+"</a>"+"<p>"+"<i></i>"+'<a href="'+i+'">设置</a>'+'<a href="" class="user-login-out">退出</a>'+"</p>"+"</span>";e.html(s),e.on("mouseenter",".user-Name",function(){$(this).find("p").show()}),e.on("mouseleave",".user-Name",function(){$(this).find("p").hide()})}else e.html(n)}):e.html(n),e.on("click",".user-login-out",function(t){t.preventDefault(),$.ajax({type:"get",dataType:"jsonp",url:App.userDataApi.userLoginOut}).done(function(t){t.errno==0?(e.html(n),location.reload()):alert("退出失败!")})})},App.userInfo=function(e){$.ajax({url:App.userDataApi.userLogin,type:"get",dataType:"jsonp"}).done(function(t){e(t)})},$(function(){App.calendar(),App.userLogin()});